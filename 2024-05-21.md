# 2024-05-21
## `ActiveSupport` の `presence_in`
https://api.rubyonrails.org/classes/Object.html#method-i-presence_in

```rb
params[:bucket_type].presence_in %w( project calendar )
```

レシーバが引数の中に含まれていればそれを返す。含まれていなければ `nil` を返す。引数は `include?` に応答できるものであれば良い

## ||= 自己代入演算子
[Ruby の ||= 演算子とは？ - スタック・オーバーフロー](https://ja.stackoverflow.com/questions/42780/ruby-%E3%81%AE-%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%A8%E3%81%AF)

`a || (a = b)` の短絡評価。これに代入する値を真偽値にしてしまうとバグの元になるかも

```rb
# hoge は未定義
hoge ||= false
# 最初の評価。hoge には false が入る
hoge == false
# 2回目の評価。hoge が評価され false なのでまた false が入る
# 3回目の評価。hoge が評価され false なのでまた false が入る
# 永遠に false が入り続けるのでは
```

こちらの例がいいかも

https://techracho.bpsinc.jp/hachi8833/2020_06_25/74938

```rb
# bad - enabledがfalseだった場合にもtrueに設定されてしまう
enabled ||= true

# good
enabled = true if enabled.nil?
```

> 「あと気をつけないといけないのは、nilが入ってくる可能性のあるオブジェクトには||=のメモ化が効かないということ: nilが入っていると結局毎回読み込みが実行されちゃうので最適化されない」

