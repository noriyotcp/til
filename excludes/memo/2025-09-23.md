---
title: "2025-09-23"
date: "2025-09-23 10:21:59 +0900"
last_modified_at: "2025-09-23 10:21:59 +0900"
draft: true
---

これはメモです

# 2025-09-23
VS Code terminal での zsh の起動が遅いのでなんとかする

```
 ❯ for i in $(seq 1 10); do time zsh -i -c exit; done
Agent pid 71160
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.91s user 1.50s system 52% cpu 6.465 total
Agent pid 71489
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.51s user 1.06s system 82% cpu 3.132 total
Agent pid 71613
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.48s user 1.06s system 80% cpu 3.153 total
Agent pid 71736
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.51s user 1.08s system 81% cpu 3.158 total
Agent pid 71862
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.53s user 1.09s system 82% cpu 3.179 total
Agent pid 71984
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.34s user 0.95s system 75% cpu 3.026 total
Agent pid 72286
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.63s user 1.17s system 77% cpu 3.622 total
Agent pid 72413
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.64s user 1.20s system 77% cpu 3.649 total
Agent pid 72540
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.40s user 0.98s system 75% cpu 3.163 total
Agent pid 72842
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.57s user 1.21s system 78% cpu 3.523 total
>>> elapsed time 37s
```

```
num  calls                time                       self            name
-----------------------------------------------------------------------------------
Agent pid 81090
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    2        1030.33   515.17   90.32%    521.13   260.57   45.68%  compinit
 2)    2         188.99    94.49   16.57%    188.99    94.49   16.57%  compaudit
 3)    1         184.26   184.26   16.15%    184.26   184.26   16.15%  compdump
 4)  944         135.96     0.14   11.92%    135.96     0.14   11.92%  compdef
 5)    1          80.51    80.51    7.06%     80.51    80.51    7.06%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]
 6)    3          11.86     3.95    1.04%     11.86     3.95    1.04%  promptinit
 7)    4          34.42     8.61    3.02%     10.83     2.71    0.95%  pmodload
 8)    3           2.24     0.75    0.20%      2.24     0.75    0.20%  is-at-least
 9)   10           1.47     0.15    0.13%      1.47     0.15    0.13%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]
10)   19           1.06     0.06    0.09%      1.06     0.06    0.09%  add-zsh-hook
11)   15           0.81     0.05    0.07%      0.78     0.05    0.07%  add-zle-hook-widget
12)    1          81.07    81.07    7.11%      0.56     0.56    0.05%  cool-peco
13)    3           0.58     0.19    0.05%      0.44     0.15    0.04%  prompt_paradox_setup
14)    1           0.24     0.24    0.02%      0.24     0.24    0.02%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]
15)    2           2.50     1.25    0.22%      0.24     0.12    0.02%  set_prompt
16)    2           2.57     1.29    0.23%      0.07     0.04    0.01%  prompt
17)    1           0.05     0.05    0.00%      0.05     0.05    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]
18)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]
19)    1           0.03     0.03    0.00%      0.02     0.02    0.00%  iterm2_print_state_data
20)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  is-callable
21)    1           0.00     0.00    0.00%      0.00     0.00    0.00%  iterm2_print_user_vars

-----------------------------------------------------------------------------------

       1/2        12.94    12.94    1.13%     12.94    12.94             pmodload [7]
 1)    2        1030.33   515.17   90.32%    521.13   260.57   45.68%  compinit
     944/944     135.96     0.14   11.92%    135.96     0.14             compdef [4]
       1/1       184.26   184.26   16.15%    184.26   184.26             compdump [3]
       1/2       188.99   188.99   16.57%      4.01     4.01             compaudit [2]

-----------------------------------------------------------------------------------

       1/2       188.99   188.99   16.57%      4.01     4.01             compinit [1]
       1/2       184.98   184.98   16.22%    184.98   184.98             compaudit [2]
 2)    2         188.99    94.49   16.57%    188.99    94.49   16.57%  compaudit
       1/2       184.98   184.98   16.22%    184.98   184.98             compaudit [2]

-----------------------------------------------------------------------------------

       1/1       184.26   184.26   16.15%    184.26   184.26             compinit [1]
 3)    1         184.26   184.26   16.15%    184.26   184.26   16.15%  compdump

-----------------------------------------------------------------------------------

     944/944     135.96     0.14   11.92%    135.96     0.14             compinit [1]
 4)  944         135.96     0.14   11.92%    135.96     0.14   11.92%  compdef

-----------------------------------------------------------------------------------

12)    1          81.07    81.07    7.11%      0.56     0.56    0.05%  cool-peco
       1/1        80.51    80.51    7.06%     80.51    80.51             (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1] [5]

-----------------------------------------------------------------------------------

       1/1        80.51    80.51    7.06%     80.51    80.51             cool-peco [12]
 5)    1          80.51    80.51    7.06%     80.51    80.51    7.06%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]

-----------------------------------------------------------------------------------

       2/4         0.34     0.17    0.03%      0.29     0.15             pmodload [7]
       1/4         0.03     0.03    0.00%      0.03     0.03             prompt_paradox_setup [13]
 7)    4          34.42     8.61    3.02%     10.83     2.71    0.95%  pmodload
       1/1         0.01     0.01    0.00%      0.01     0.01             is-callable [20]
       1/1         0.05     0.05    0.00%      0.05     0.05             (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114] [17]
       1/3         0.05     0.05    0.00%      0.05     0.05             is-at-least [8]
       2/4         0.34     0.17    0.03%      0.29     0.15             pmodload [7]
      10/10        1.47     0.15    0.13%      1.47     0.15             (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114] [9]
       1/2         1.92     1.92    0.17%      0.05     0.05             prompt [16]
       1/3         7.18     7.18    0.63%      0.92     0.92             promptinit [6]
       1/2        12.94    12.94    1.13%     12.94    12.94             compinit [1]

-----------------------------------------------------------------------------------

       1/3         7.18     7.18    0.63%      0.92     0.92             pmodload [7]
       1/3         6.26     6.26    0.55%      6.26     6.26             promptinit [6]
 6)    3          11.86     3.95    1.04%     11.86     3.95    1.04%  promptinit
       1/3         6.26     6.26    0.55%      6.26     6.26             promptinit [6]

-----------------------------------------------------------------------------------

       1/2         1.92     1.92    0.17%      0.05     0.05             pmodload [7]
16)    2           2.57     1.29    0.23%      0.07     0.04    0.01%  prompt
       2/2         2.50     1.25    0.22%      0.24     0.12             set_prompt [15]

-----------------------------------------------------------------------------------

       2/2         2.50     1.25    0.22%      0.24     0.12             prompt [16]
15)    2           2.50     1.25    0.22%      0.24     0.12    0.02%  set_prompt
       2/3         0.58     0.29    0.05%      0.37     0.19             prompt_paradox_setup [13]
      14/15        0.81     0.06    0.07%      0.75     0.05             add-zle-hook-widget [11]
      14/19        0.88     0.06    0.08%      0.88     0.06             add-zsh-hook [10]

-----------------------------------------------------------------------------------

       1/3         0.05     0.05    0.00%      0.05     0.05             pmodload [7]
 8)    3           2.24     0.75    0.20%      2.24     0.75    0.20%  is-at-least

-----------------------------------------------------------------------------------

      10/10        1.47     0.15    0.13%      1.47     0.15             pmodload [7]
 9)   10           1.47     0.15    0.13%      1.47     0.15    0.13%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]

-----------------------------------------------------------------------------------

      14/19        0.88     0.06    0.08%      0.88     0.06             set_prompt [15]
       4/19        0.12     0.03    0.01%      0.12     0.03             prompt_paradox_setup [13]
10)   19           1.06     0.06    0.09%      1.06     0.06    0.09%  add-zsh-hook

-----------------------------------------------------------------------------------

      14/15        0.81     0.06    0.07%      0.75     0.05             set_prompt [15]
       1/15        0.03     0.03    0.00%      0.03     0.03             add-zle-hook-widget [11]
11)   15           0.81     0.05    0.07%      0.78     0.05    0.07%  add-zle-hook-widget
       1/1         0.03     0.03    0.00%      0.03     0.03             (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28] [18]
       1/15        0.03     0.03    0.00%      0.03     0.03             add-zle-hook-widget [11]

-----------------------------------------------------------------------------------

       2/3         0.58     0.29    0.05%      0.37     0.19             set_prompt [15]
       1/3         0.12     0.12    0.01%      0.06     0.06             prompt_paradox_setup [13]
13)    3           0.58     0.19    0.05%      0.44     0.15    0.04%  prompt_paradox_setup
       1/4         0.03     0.03    0.00%      0.03     0.03             pmodload [7]
       4/19        0.12     0.03    0.01%      0.12     0.03             add-zsh-hook [10]
       1/3         0.12     0.12    0.01%      0.06     0.06             prompt_paradox_setup [13]

-----------------------------------------------------------------------------------

14)    1           0.24     0.24    0.02%      0.24     0.24    0.02%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]

-----------------------------------------------------------------------------------

       1/1         0.05     0.05    0.00%      0.05     0.05             pmodload [7]
17)    1           0.05     0.05    0.00%      0.05     0.05    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]

-----------------------------------------------------------------------------------

19)    1           0.03     0.03    0.00%      0.02     0.02    0.00%  iterm2_print_state_data
       1/1         0.00     0.00    0.00%      0.00     0.00             iterm2_print_user_vars [21]

-----------------------------------------------------------------------------------

       1/1         0.03     0.03    0.00%      0.03     0.03             add-zle-hook-widget [11]
18)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]

-----------------------------------------------------------------------------------

       1/1         0.01     0.01    0.00%      0.01     0.01             pmodload [7]
20)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  is-callable

-----------------------------------------------------------------------------------

       1/1         0.00     0.00    0.00%      0.00     0.00             iterm2_print_state_data [19]
21)    1           0.00     0.00    0.00%      0.00     0.00    0.00%  iterm2_print_user_vars
```

compdef が時間かかってるな。なんでだろう

でもその後に再起動したときは compdef はなさそう？よくわからない

```
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    2         473.79   236.89   40.35%    469.64   234.82   39.99%  iterm2_print_user_vars
 2)    2         319.54   159.77   27.21%    319.49   159.74   27.21%  git-info
 3)    1         106.00   106.00    9.03%    106.00   106.00    9.03%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]
 4)    4          90.45    22.61    7.70%     90.45    22.61    7.70%  compaudit
 5)    1          76.91    76.91    6.55%     76.91    76.91    6.55%  _direnv_hook
 6)    4          17.62     4.40    1.50%     17.62     4.40    1.50%  promptinit
 7)    1          16.71    16.71    1.42%     16.71    16.71    1.42%  __vsc_update_cwd
 8)    3         103.08    34.36    8.78%     12.63     4.21    1.08%  compinit
 9)    5          23.85     4.77    2.03%     11.38     2.28    0.97%  pmodload
10)  206           8.89     0.04    0.76%      7.44     0.04    0.63%  _zsh_autosuggest_bind_widget
11)    1           5.83     5.83    0.50%      5.83     5.83    0.50%  __vsc_command_output_start
12)    1           4.15     4.15    0.35%      4.15     4.15    0.35%  iterm2_set_user_var
13)    2           3.93     1.97    0.33%      3.93     1.97    0.33%  _zsh_autosuggest_orig_reset-prompt
14)    1          12.82    12.82    1.09%      3.93     3.93    0.33%  _zsh_autosuggest_bind_widgets
15)    2           3.64     1.82    0.31%      3.28     1.64    0.28%  _zsh_autosuggest_async_request
16)    1           2.58     2.58    0.22%      2.58     2.58    0.22%  _zsh_autosuggest_orig_clear-screen
17)    1           2.12     2.12    0.18%      2.12     2.12    0.18%  __vsc_update_prompt
18)   12          10.48     0.87    0.89%      1.72     0.14    0.15%  _zsh_autosuggest_invoke_original_widget
19)    1           1.59     1.59    0.14%      1.59     1.59    0.14%  iterm2_decorate_prompt
20)  206           1.45     0.01    0.12%      1.45     0.01    0.12%  _zsh_autosuggest_incr_bind_count
21)   31           1.33     0.04    0.11%      1.33     0.04    0.11%  add-zsh-hook
22)   11          16.72     1.52    1.42%      1.31     0.12    0.11%  _zsh_autosuggest_widget_modify
23)    7           1.29     0.18    0.11%      1.29     0.18    0.11%  url-quote-magic
24)    1         320.81   320.81   27.32%      1.25     1.25    0.11%  prompt_paradox_precmd
25)   11          14.92     1.36    1.27%      1.14     0.10    0.10%  _zsh_autosuggest_modify
26)    8           1.09     0.14    0.09%      1.09     0.14    0.09%  is-at-least
27)   10           1.01     0.10    0.09%      1.01     0.10    0.09%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]
28)   22           0.99     0.04    0.08%      0.96     0.04    0.08%  add-zle-hook-widget
29)    2           1.21     0.61    0.10%      0.83     0.41    0.07%  _zsh_autosuggest_async_response
30)    6           8.66     1.44    0.74%      0.62     0.10    0.05%  _zsh_autosuggest_bound_1_self-insert
31)    4           0.82     0.21    0.07%      0.59     0.15    0.05%  prompt_paradox_setup
32)   14           0.55     0.04    0.05%      0.55     0.04    0.05%  _zsh_autosuggest_highlight_reset
33)    3           3.06     1.02    0.26%      0.42     0.14    0.04%  set_prompt
34)   14           0.36     0.03    0.03%      0.36     0.03    0.03%  _zsh_autosuggest_highlight_apply
35)    2         106.33    53.16    9.05%      0.33     0.16    0.03%  cool-peco
36)    2           0.26     0.13    0.02%      0.26     0.13    0.02%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]
37)    2           5.08     2.54    0.43%      0.24     0.12    0.02%  editor-info
38)    2           0.38     0.19    0.03%      0.21     0.11    0.02%  _zsh_autosuggest_widget_suggest
39)    2           4.83     2.42    0.41%      0.17     0.09    0.01%  zle-reset-prompt
40)    1           4.09     4.09    0.35%      0.15     0.15    0.01%  zle-line-finish
41)    3           3.18     1.06    0.27%      0.12     0.04    0.01%  prompt
42)    1           0.42     0.42    0.04%      0.11     0.11    0.01%  _zsh_autosuggest_widget_clear
43)    1           3.27     3.27    0.28%      0.10     0.10    0.01%  _zsh_autosuggest_bound_1_clear-screen
44)    2           4.66     2.33    0.40%      0.09     0.05    0.01%  _zsh_autosuggest_bound_1_reset-prompt
45)    1          18.96    18.96    1.61%      0.06     0.06    0.01%  __vsc_precmd
46)    1           0.48     0.48    0.04%      0.06     0.06    0.01%  _zsh_autosuggest_bound_1_accept-line
47)    2           0.06     0.03    0.01%      0.06     0.03    0.01%  _zsh_autosuggest_suggest
48)    2         473.85   236.92   40.35%      0.06     0.03    0.01%  iterm2_print_state_data
49)    1           1.68     1.68    0.14%      0.06     0.06    0.00%  zle-line-init
50)    2           0.06     0.03    0.00%      0.06     0.03    0.00%  is-true
51)    2           3.69     1.84    0.31%      0.05     0.03    0.00%  _zsh_autosuggest_fetch
52)    1         475.46   475.46   40.49%      0.05     0.05    0.00%  iterm2_precmd
53)    2           5.56     2.78    0.47%      0.05     0.02    0.00%  _zsh_autosuggest_bound_1_editor-info
54)    1           5.87     5.87    0.50%      0.04     0.04    0.00%  __vsc_preexec
55)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]
56)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  _zsh_autosuggest_orig_accept-line
57)    1          12.85    12.85    1.09%      0.04     0.04    0.00%  _zsh_autosuggest_start
58)    1          16.74    16.74    1.43%      0.04     0.04    0.00%  __vsc_command_complete
59)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  __vsc_update_env
60)    1           0.26     0.26    0.02%      0.03     0.03    0.00%  _zsh_autosuggest_clear
61)    1         473.82   473.82   40.35%      0.03     0.03    0.00%  iterm2_after_cmd_executes
62)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]
63)    1           0.04     0.04    0.00%      0.02     0.02    0.00%  iterm2_preexec
64)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  prompt_paradox_preexec
65)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable
66)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  iterm2_before_cmd_executes
67)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  prompt_paradox_print_elapsed_time

-----------------------------------------------------------------------------------

52)    1         475.46   475.46   40.49%      0.05     0.05    0.00%  iterm2_precmd
       1/1         1.59     1.59    0.14%      1.59     1.59             iterm2_decorate_prompt [19]
       1/1       473.82   473.82   40.35%      0.03     0.03             iterm2_after_cmd_executes [61]

-----------------------------------------------------------------------------------

       1/2       473.80   473.80   40.35%      0.02     0.02             iterm2_after_cmd_executes [61]
48)    2         473.85   236.92   40.35%      0.06     0.03    0.01%  iterm2_print_state_data
       2/2       473.79   236.89   40.35%    469.64   234.82             iterm2_print_user_vars [1]

-----------------------------------------------------------------------------------

       1/1       473.82   473.82   40.35%      0.03     0.03             iterm2_precmd [52]
61)    1         473.82   473.82   40.35%      0.03     0.03    0.00%  iterm2_after_cmd_executes
       1/2       473.80   473.80   40.35%      0.02     0.02             iterm2_print_state_data [48]

-----------------------------------------------------------------------------------

       2/2       473.79   236.89   40.35%    469.64   234.82             iterm2_print_state_data [48]
 1)    2         473.79   236.89   40.35%    469.64   234.82   39.99%  iterm2_print_user_vars
       1/1         4.15     4.15    0.35%      4.15     4.15             iterm2_set_user_var [12]

-----------------------------------------------------------------------------------

24)    1         320.81   320.81   27.32%      1.25     1.25    0.11%  prompt_paradox_precmd
       1/1         0.01     0.01    0.00%      0.01     0.01             prompt_paradox_print_elapsed_time [67]
       1/2       319.54   319.54   27.21%      0.96     0.96             git-info [2]

-----------------------------------------------------------------------------------

       1/2       319.54   319.54   27.21%      0.96     0.96             prompt_paradox_precmd [24]
       1/2       318.59   318.59   27.13%    318.53   318.53             git-info [2]
 2)    2         319.54   159.77   27.21%    319.49   159.74   27.21%  git-info
       2/2         0.06     0.03    0.00%      0.06     0.03             is-true [50]
       1/2       318.59   318.59   27.13%    318.53   318.53             git-info [2]

-----------------------------------------------------------------------------------

35)    2         106.33    53.16    9.05%      0.33     0.16    0.03%  cool-peco
       1/1       106.00   106.00    9.03%    106.00   106.00             (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1] [3]

-----------------------------------------------------------------------------------

       1/1       106.00   106.00    9.03%    106.00   106.00             cool-peco [35]
 3)    1         106.00   106.00    9.03%    106.00   106.00    9.03%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]

-----------------------------------------------------------------------------------

       1/3         4.34     4.34    0.37%      4.34     4.34             pmodload [9]
 8)    3         103.08    34.36    8.78%     12.63     4.21    1.08%  compinit
       2/4        90.45    45.22    7.70%      0.39     0.19             compaudit [4]

-----------------------------------------------------------------------------------

       2/4        90.45    45.22    7.70%      0.39     0.19             compinit [8]
       2/4        90.06    45.03    7.67%     90.06    45.03             compaudit [4]
 4)    4          90.45    22.61    7.70%     90.45    22.61    7.70%  compaudit
       2/4        90.06    45.03    7.67%     90.06    45.03             compaudit [4]

-----------------------------------------------------------------------------------

 5)    1          76.91    76.91    6.55%     76.91    76.91    6.55%  _direnv_hook

-----------------------------------------------------------------------------------

       2/5         0.35     0.17    0.03%      0.30     0.15             pmodload [9]
       1/5         0.03     0.03    0.00%      0.03     0.03             prompt_paradox_setup [31]
 9)    5          23.85     4.77    2.03%     11.38     2.28    0.97%  pmodload
       1/1         0.02     0.02    0.00%      0.02     0.02             is-callable [65]
       1/1         0.04     0.04    0.00%      0.04     0.04             (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114] [55]
       1/8         0.06     0.06    0.00%      0.06     0.06             is-at-least [26]
       2/5         0.35     0.17    0.03%      0.30     0.15             pmodload [9]
      10/10        1.01     0.10    0.09%      1.01     0.10             (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114] [27]
       1/3         1.65     1.65    0.14%      0.06     0.06             prompt [41]
       1/3         4.34     4.34    0.37%      4.34     4.34             compinit [8]
       1/4         5.38     5.38    0.46%      0.53     0.53             promptinit [6]

-----------------------------------------------------------------------------------

45)    1          18.96    18.96    1.61%      0.06     0.06    0.01%  __vsc_precmd
       1/1         0.03     0.03    0.00%      0.03     0.03             __vsc_update_env [59]
       1/1         2.12     2.12    0.18%      2.12     2.12             __vsc_update_prompt [17]
       1/1        16.74    16.74    1.43%      0.04     0.04             __vsc_command_complete [58]

-----------------------------------------------------------------------------------

       1/4         5.38     5.38    0.46%      0.53     0.53             pmodload [9]
       1/4         4.85     4.85    0.41%      4.85     4.85             promptinit [6]
 6)    4          17.62     4.40    1.50%     17.62     4.40    1.50%  promptinit
       1/4         4.85     4.85    0.41%      4.85     4.85             promptinit [6]

-----------------------------------------------------------------------------------

       1/1        16.74    16.74    1.43%      0.04     0.04             __vsc_precmd [45]
58)    1          16.74    16.74    1.43%      0.04     0.04    0.00%  __vsc_command_complete
       1/1        16.71    16.71    1.42%     16.71    16.71             __vsc_update_cwd [7]

-----------------------------------------------------------------------------------

       6/11        8.04     1.34    0.68%      0.80     0.13             _zsh_autosuggest_bound_1_self-insert [30]
       2/11        5.51     2.76    0.47%      0.11     0.05             _zsh_autosuggest_bound_1_editor-info [53]
       2/11        4.57     2.29    0.39%      0.21     0.10             _zsh_autosuggest_bound_1_reset-prompt [44]
       1/11        3.17     3.17    0.27%      0.19     0.19             _zsh_autosuggest_bound_1_clear-screen [43]
22)   11          16.72     1.52    1.42%      1.31     0.12    0.11%  _zsh_autosuggest_widget_modify
      11/14        0.30     0.03    0.03%      0.30     0.03             _zsh_autosuggest_highlight_apply [34]
      11/14        0.45     0.04    0.04%      0.45     0.04             _zsh_autosuggest_highlight_reset [32]
      11/11       19.23     1.75    1.64%      1.14     0.10             _zsh_autosuggest_modify [25]

-----------------------------------------------------------------------------------

       1/1        16.71    16.71    1.42%     16.71    16.71             __vsc_command_complete [58]
 7)    1          16.71    16.71    1.42%     16.71    16.71    1.42%  __vsc_update_cwd

-----------------------------------------------------------------------------------

      11/11       19.23     1.75    1.64%      1.14     0.10             _zsh_autosuggest_widget_modify [22]
25)   11          14.92     1.36    1.27%      1.14     0.10    0.10%  _zsh_autosuggest_modify
       2/2         3.69     1.84    0.31%      0.05     0.03             _zsh_autosuggest_fetch [51]
      11/12       14.41     1.31    1.23%      1.53     0.14             _zsh_autosuggest_invoke_original_widget [18]

-----------------------------------------------------------------------------------

57)    1          12.85    12.85    1.09%      0.04     0.04    0.00%  _zsh_autosuggest_start
       1/1        12.82    12.82    1.09%      3.93     3.93             _zsh_autosuggest_bind_widgets [14]

-----------------------------------------------------------------------------------

       1/1        12.82    12.82    1.09%      3.93     3.93             _zsh_autosuggest_start [57]
14)    1          12.82    12.82    1.09%      3.93     3.93    0.33%  _zsh_autosuggest_bind_widgets
     206/206       8.89     0.04    0.76%      7.44     0.04             _zsh_autosuggest_bind_widget [10]

-----------------------------------------------------------------------------------

      11/12       14.41     1.31    1.23%      1.53     0.14             _zsh_autosuggest_modify [25]
       1/12        0.23     0.23    0.02%      0.19     0.19             _zsh_autosuggest_clear [60]
18)   12          10.48     0.87    0.89%      1.72     0.14    0.15%  _zsh_autosuggest_invoke_original_widget
       1/1         0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_orig_accept-line [56]
       6/7         1.29     0.21    0.11%      1.24     0.21             url-quote-magic [23]
       1/1         2.58     2.58    0.22%      2.58     2.58             _zsh_autosuggest_orig_clear-screen [16]
       2/2         3.93     1.97    0.33%      3.93     1.97             _zsh_autosuggest_orig_reset-prompt [13]
       2/2         5.08     2.54    0.43%      0.24     0.12             editor-info [37]

-----------------------------------------------------------------------------------

     206/206       8.89     0.04    0.76%      7.44     0.04             _zsh_autosuggest_bind_widgets [14]
10)  206           8.89     0.04    0.76%      7.44     0.04    0.63%  _zsh_autosuggest_bind_widget
     206/206       1.45     0.01    0.12%      1.45     0.01             _zsh_autosuggest_incr_bind_count [20]

-----------------------------------------------------------------------------------

30)    6           8.66     1.44    0.74%      0.62     0.10    0.05%  _zsh_autosuggest_bound_1_self-insert
       6/11        8.04     1.34    0.68%      0.80     0.13             _zsh_autosuggest_widget_modify [22]

-----------------------------------------------------------------------------------

54)    1           5.87     5.87    0.50%      0.04     0.04    0.00%  __vsc_preexec
       1/1         5.83     5.83    0.50%      5.83     5.83             __vsc_command_output_start [11]

-----------------------------------------------------------------------------------

       1/1         5.83     5.83    0.50%      5.83     5.83             __vsc_preexec [54]
11)    1           5.83     5.83    0.50%      5.83     5.83    0.50%  __vsc_command_output_start

-----------------------------------------------------------------------------------

       1/2         3.94     3.94    0.34%      0.03     0.03             zle-line-finish [40]
       1/2         1.62     1.62    0.14%      0.01     0.01             zle-line-init [49]
53)    2           5.56     2.78    0.47%      0.05     0.02    0.00%  _zsh_autosuggest_bound_1_editor-info
       2/11        5.51     2.76    0.47%      0.11     0.05             _zsh_autosuggest_widget_modify [22]

-----------------------------------------------------------------------------------

       2/2         5.08     2.54    0.43%      0.24     0.12             _zsh_autosuggest_invoke_original_widget [18]
37)    2           5.08     2.54    0.43%      0.24     0.12    0.02%  editor-info
       2/2         4.83     2.42    0.41%      0.17     0.09             zle-reset-prompt [39]

-----------------------------------------------------------------------------------

       2/2         4.83     2.42    0.41%      0.17     0.09             editor-info [37]
39)    2           4.83     2.42    0.41%      0.17     0.09    0.01%  zle-reset-prompt
       2/2         4.66     2.33    0.40%      0.09     0.05             _zsh_autosuggest_bound_1_reset-prompt [44]

-----------------------------------------------------------------------------------

       2/2         4.66     2.33    0.40%      0.09     0.05             zle-reset-prompt [39]
44)    2           4.66     2.33    0.40%      0.09     0.05    0.01%  _zsh_autosuggest_bound_1_reset-prompt
       2/11        4.57     2.29    0.39%      0.21     0.10             _zsh_autosuggest_widget_modify [22]

-----------------------------------------------------------------------------------

       1/1         4.15     4.15    0.35%      4.15     4.15             iterm2_print_user_vars [1]
12)    1           4.15     4.15    0.35%      4.15     4.15    0.35%  iterm2_set_user_var

-----------------------------------------------------------------------------------

40)    1           4.09     4.09    0.35%      0.15     0.15    0.01%  zle-line-finish
       1/2         3.94     3.94    0.34%      0.03     0.03             _zsh_autosuggest_bound_1_editor-info [53]

-----------------------------------------------------------------------------------

       2/2         3.93     1.97    0.33%      3.93     1.97             _zsh_autosuggest_invoke_original_widget [18]
13)    2           3.93     1.97    0.33%      3.93     1.97    0.33%  _zsh_autosuggest_orig_reset-prompt

-----------------------------------------------------------------------------------

       2/2         3.69     1.84    0.31%      0.05     0.03             _zsh_autosuggest_modify [25]
51)    2           3.69     1.84    0.31%      0.05     0.03    0.00%  _zsh_autosuggest_fetch
       2/2         3.64     1.82    0.31%      3.28     1.64             _zsh_autosuggest_async_request [15]

-----------------------------------------------------------------------------------

       2/2         3.64     1.82    0.31%      3.28     1.64             _zsh_autosuggest_fetch [51]
15)    2           3.64     1.82    0.31%      3.28     1.64    0.28%  _zsh_autosuggest_async_request
       2/8         0.35     0.18    0.03%      0.35     0.18             is-at-least [26]

-----------------------------------------------------------------------------------

43)    1           3.27     3.27    0.28%      0.10     0.10    0.01%  _zsh_autosuggest_bound_1_clear-screen
       1/11        3.17     3.17    0.27%      0.19     0.19             _zsh_autosuggest_widget_modify [22]

-----------------------------------------------------------------------------------

       1/3         1.65     1.65    0.14%      0.06     0.06             pmodload [9]
41)    3           3.18     1.06    0.27%      0.12     0.04    0.01%  prompt
       3/3         3.06     1.02    0.26%      0.42     0.14             set_prompt [33]

-----------------------------------------------------------------------------------

       3/3         3.06     1.02    0.26%      0.42     0.14             prompt [41]
33)    3           3.06     1.02    0.26%      0.42     0.14    0.04%  set_prompt
       3/4         0.82     0.27    0.07%      0.51     0.17             prompt_paradox_setup [31]
      21/31        0.83     0.04    0.07%      0.83     0.04             add-zsh-hook [21]
      21/22        0.99     0.05    0.08%      0.92     0.04             add-zle-hook-widget [28]

-----------------------------------------------------------------------------------

       1/1         2.58     2.58    0.22%      2.58     2.58             _zsh_autosuggest_invoke_original_widget [18]
16)    1           2.58     2.58    0.22%      2.58     2.58    0.22%  _zsh_autosuggest_orig_clear-screen

-----------------------------------------------------------------------------------

       1/1         2.12     2.12    0.18%      2.12     2.12             __vsc_precmd [45]
17)    1           2.12     2.12    0.18%      2.12     2.12    0.18%  __vsc_update_prompt

-----------------------------------------------------------------------------------

49)    1           1.68     1.68    0.14%      0.06     0.06    0.00%  zle-line-init
       1/2         1.62     1.62    0.14%      0.01     0.01             _zsh_autosuggest_bound_1_editor-info [53]

-----------------------------------------------------------------------------------

       1/1         1.59     1.59    0.14%      1.59     1.59             iterm2_precmd [52]
19)    1           1.59     1.59    0.14%      1.59     1.59    0.14%  iterm2_decorate_prompt

-----------------------------------------------------------------------------------

     206/206       1.45     0.01    0.12%      1.45     0.01             _zsh_autosuggest_bind_widget [10]
20)  206           1.45     0.01    0.12%      1.45     0.01    0.12%  _zsh_autosuggest_incr_bind_count

-----------------------------------------------------------------------------------

      21/31        0.83     0.04    0.07%      0.83     0.04             set_prompt [33]
       6/31        0.20     0.03    0.02%      0.20     0.03             prompt_paradox_setup [31]
21)   31           1.33     0.04    0.11%      1.33     0.04    0.11%  add-zsh-hook

-----------------------------------------------------------------------------------

       6/7         1.29     0.21    0.11%      1.24     0.21             _zsh_autosuggest_invoke_original_widget [18]
       1/7         0.04     0.04    0.00%      0.04     0.04             url-quote-magic [23]
23)    7           1.29     0.18    0.11%      1.29     0.18    0.11%  url-quote-magic
       1/7         0.04     0.04    0.00%      0.04     0.04             url-quote-magic [23]

-----------------------------------------------------------------------------------

29)    2           1.21     0.61    0.10%      0.83     0.41    0.07%  _zsh_autosuggest_async_response
       2/2         0.38     0.19    0.03%      0.21     0.11             _zsh_autosuggest_widget_suggest [38]

-----------------------------------------------------------------------------------

       2/8         0.35     0.18    0.03%      0.35     0.18             _zsh_autosuggest_async_request [15]
       1/8         0.06     0.06    0.00%      0.06     0.06             pmodload [9]
26)    8           1.09     0.14    0.09%      1.09     0.14    0.09%  is-at-least

-----------------------------------------------------------------------------------

      10/10        1.01     0.10    0.09%      1.01     0.10             pmodload [9]
27)   10           1.01     0.10    0.09%      1.01     0.10    0.09%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]

-----------------------------------------------------------------------------------

      21/22        0.99     0.05    0.08%      0.92     0.04             set_prompt [33]
       1/22        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [28]
28)   22           0.99     0.04    0.08%      0.96     0.04    0.08%  add-zle-hook-widget
       1/1         0.02     0.02    0.00%      0.02     0.02             (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28] [62]
       1/22        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [28]

-----------------------------------------------------------------------------------

       3/4         0.82     0.27    0.07%      0.51     0.17             set_prompt [33]
       1/4         0.14     0.14    0.01%      0.07     0.07             prompt_paradox_setup [31]
31)    4           0.82     0.21    0.07%      0.59     0.15    0.05%  prompt_paradox_setup
       1/5         0.03     0.03    0.00%      0.03     0.03             pmodload [9]
       1/4         0.14     0.14    0.01%      0.07     0.07             prompt_paradox_setup [31]
       6/31        0.20     0.03    0.02%      0.20     0.03             add-zsh-hook [21]

-----------------------------------------------------------------------------------

      11/14        0.45     0.04    0.04%      0.45     0.04             _zsh_autosuggest_widget_modify [22]
       2/14        0.06     0.03    0.01%      0.06     0.03             _zsh_autosuggest_widget_suggest [38]
       1/14        0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_widget_clear [42]
32)   14           0.55     0.04    0.05%      0.55     0.04    0.05%  _zsh_autosuggest_highlight_reset

-----------------------------------------------------------------------------------

46)    1           0.48     0.48    0.04%      0.06     0.06    0.01%  _zsh_autosuggest_bound_1_accept-line
       1/1         0.42     0.42    0.04%      0.11     0.11             _zsh_autosuggest_widget_clear [42]

-----------------------------------------------------------------------------------

       1/1         0.42     0.42    0.04%      0.11     0.11             _zsh_autosuggest_bound_1_accept-line [46]
42)    1           0.42     0.42    0.04%      0.11     0.11    0.01%  _zsh_autosuggest_widget_clear
       1/14        0.02     0.02    0.00%      0.02     0.02             _zsh_autosuggest_highlight_apply [34]
       1/14        0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_highlight_reset [32]
       1/1         0.26     0.26    0.02%      0.03     0.03             _zsh_autosuggest_clear [60]

-----------------------------------------------------------------------------------

       2/2         0.38     0.19    0.03%      0.21     0.11             _zsh_autosuggest_async_response [29]
38)    2           0.38     0.19    0.03%      0.21     0.11    0.02%  _zsh_autosuggest_widget_suggest
       2/14        0.05     0.02    0.00%      0.05     0.02             _zsh_autosuggest_highlight_apply [34]
       2/14        0.06     0.03    0.01%      0.06     0.03             _zsh_autosuggest_highlight_reset [32]
       2/2         0.06     0.03    0.01%      0.06     0.03             _zsh_autosuggest_suggest [47]

-----------------------------------------------------------------------------------

      11/14        0.30     0.03    0.03%      0.30     0.03             _zsh_autosuggest_widget_modify [22]
       2/14        0.05     0.02    0.00%      0.05     0.02             _zsh_autosuggest_widget_suggest [38]
       1/14        0.02     0.02    0.00%      0.02     0.02             _zsh_autosuggest_widget_clear [42]
34)   14           0.36     0.03    0.03%      0.36     0.03    0.03%  _zsh_autosuggest_highlight_apply

-----------------------------------------------------------------------------------

36)    2           0.26     0.13    0.02%      0.26     0.13    0.02%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]

-----------------------------------------------------------------------------------

       1/1         0.26     0.26    0.02%      0.03     0.03             _zsh_autosuggest_widget_clear [42]
60)    1           0.26     0.26    0.02%      0.03     0.03    0.00%  _zsh_autosuggest_clear
       1/12        0.23     0.23    0.02%      0.19     0.19             _zsh_autosuggest_invoke_original_widget [18]

-----------------------------------------------------------------------------------

       2/2         0.06     0.03    0.01%      0.06     0.03             _zsh_autosuggest_widget_suggest [38]
47)    2           0.06     0.03    0.01%      0.06     0.03    0.01%  _zsh_autosuggest_suggest

-----------------------------------------------------------------------------------

       2/2         0.06     0.03    0.00%      0.06     0.03             git-info [2]
50)    2           0.06     0.03    0.00%      0.06     0.03    0.00%  is-true

-----------------------------------------------------------------------------------

       1/1         0.04     0.04    0.00%      0.04     0.04             pmodload [9]
55)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]

-----------------------------------------------------------------------------------

63)    1           0.04     0.04    0.00%      0.02     0.02    0.00%  iterm2_preexec
       1/1         0.01     0.01    0.00%      0.01     0.01             iterm2_before_cmd_executes [66]

-----------------------------------------------------------------------------------

       1/1         0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_invoke_original_widget [18]
56)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  _zsh_autosuggest_orig_accept-line

-----------------------------------------------------------------------------------

       1/1         0.03     0.03    0.00%      0.03     0.03             __vsc_precmd [45]
59)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  __vsc_update_env

-----------------------------------------------------------------------------------

       1/1         0.02     0.02    0.00%      0.02     0.02             add-zle-hook-widget [28]
62)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]

-----------------------------------------------------------------------------------

64)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  prompt_paradox_preexec

-----------------------------------------------------------------------------------

       1/1         0.02     0.02    0.00%      0.02     0.02             pmodload [9]
65)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable

-----------------------------------------------------------------------------------

       1/1         0.01     0.01    0.00%      0.01     0.01             iterm2_preexec [63]
66)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  iterm2_before_cmd_executes

-----------------------------------------------------------------------------------

       1/1         0.01     0.01    0.00%      0.01     0.01             prompt_paradox_precmd [24]
67)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  prompt_paradox_print_elapsed_time
```

---

https://zsh.sourceforge.io/Doc/Release/Completion-System.html#Initialization
公式を見てもdump file を消す方法がよくわからなかった。

-D
  は「ダンプ機能（キャッシュ機能）を無効にする」オプションですね。つまり、-D
  を使うと毎回キャッシュを使わずにフル初期化が走ってしまい、起動が常に遅くなっ
  てしまいます。私の理解が間違っており、混乱させてしまい申し訳ありませんでした
  。

  目的は「キャッシュ機能は有効なまま、古くなったキャッシュファイルだけを一度削
  除して再作成させる」ことです。

  そう考えると、やはり最初の提案に戻り、キャッシュファイルである .zcompdump
  を手動で一度削除（またはリネーム）して、zshに再作成させるのが正しい手順となり
  ます。

Gemini が提示した `-D` オプションを使うと、zsh の起動が遅くなるので、とりまこれでやる。

`mv ~/.zcompdump ~/.zcompdump.bak`

これで古いキャッシュファイルはなくなりました。次に新しいシェルを起動すると、c
  ompinitが実行されて、新しいキャッシュファイルが自動的に作成されます。

  注意： 次に開くシェルは、キャッシュを再作成するため一度だけ起動が遅くなります
  。しかし、その次に開くシェルからは高速化されているはずです。

  お手数ですが、一度新しいターミナルを開いてzshを起動し、それを閉じてから、もう
  一度新しいターミナルを開いてみてください。2回目の起動が速くなったか確認いただ
  けますか？

zcompdump を削除してからターミナル再起動。初回は時間かかるので2回やる

1回目

```
num  calls                time                       self            name
-----------------------------------------------------------------------------------
Agent pid 11751
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    2         286.51   143.25   32.59%    286.51   143.25   32.59%  compdump
 2)    2         753.95   376.98   85.76%    227.21   113.60   25.84%  compinit
 3) 1883         163.82     0.09   18.63%    163.82     0.09   18.63%  compdef
 4)    1          94.37    94.37   10.73%     94.37    94.37   10.73%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]
 5)    4          76.42    19.11    8.69%     76.42    19.11    8.69%  compaudit
 6)    4         445.03   111.26   50.62%     12.29     3.07    1.40%  pmodload
 7)    3          11.62     3.87    1.32%     11.62     3.87    1.32%  promptinit
 8)    3           2.01     0.67    0.23%      2.01     0.67    0.23%  is-at-least
 9)   10           1.72     0.17    0.20%      1.72     0.17    0.20%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]
10)   19           0.82     0.04    0.09%      0.82     0.04    0.09%  add-zsh-hook
11)   15           0.81     0.05    0.09%      0.78     0.05    0.09%  add-zle-hook-widget
12)    3           0.68     0.23    0.08%      0.52     0.17    0.06%  prompt_paradox_setup
13)    1          94.81    94.81   10.78%      0.44     0.44    0.05%  cool-peco
14)    2           2.40     1.20    0.27%      0.26     0.13    0.03%  set_prompt
15)    1           0.12     0.12    0.01%      0.12     0.12    0.01%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]
16)    2           2.48     1.24    0.28%      0.08     0.04    0.01%  prompt
17)    1           0.04     0.04    0.01%      0.04     0.04    0.01%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]
18)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  iterm2_print_state_data
19)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]
20)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable
21)    1           0.00     0.00    0.00%      0.00     0.00    0.00%  iterm2_print_user_vars

-----------------------------------------------------------------------------------

       1/2       421.75   421.75   47.97%    148.44   148.44             pmodload [6]
 2)    2         753.95   376.98   85.76%    227.21   113.60   25.84%  compinit
       2/4        76.42    38.21    8.69%      0.39     0.19             compaudit [5]
    1883/1883    163.82     0.09   18.63%    163.82     0.09             compdef [3]
       2/2       286.51   143.25   32.59%    286.51   143.25             compdump [1]

-----------------------------------------------------------------------------------

       2/4         0.36     0.18    0.04%      0.32     0.16             pmodload [6]
       1/4         0.03     0.03    0.00%      0.03     0.03             prompt_paradox_setup [12]
 6)    4         445.03   111.26   50.62%     12.29     3.07    1.40%  pmodload
       1/1         0.02     0.02    0.00%      0.02     0.02             is-callable [20]
       1/1         0.04     0.04    0.01%      0.04     0.04             (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114] [17]
       1/3         0.05     0.05    0.01%      0.05     0.05             is-at-least [8]
       2/4         0.36     0.18    0.04%      0.32     0.16             pmodload [6]
      10/10        1.72     0.17    0.20%      1.72     0.17             (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114] [9]
       1/2         1.79     1.79    0.20%      0.06     0.06             prompt [16]
       1/3         7.41     7.41    0.84%      0.97     0.97             promptinit [7]
       1/2       421.75   421.75   47.97%    148.44   148.44             compinit [2]

-----------------------------------------------------------------------------------

       2/2       286.51   143.25   32.59%    286.51   143.25             compinit [2]
 1)    2         286.51   143.25   32.59%    286.51   143.25   32.59%  compdump

-----------------------------------------------------------------------------------

    1883/1883    163.82     0.09   18.63%    163.82     0.09             compinit [2]
 3) 1883         163.82     0.09   18.63%    163.82     0.09   18.63%  compdef

-----------------------------------------------------------------------------------

13)    1          94.81    94.81   10.78%      0.44     0.44    0.05%  cool-peco
       1/1        94.37    94.37   10.73%     94.37    94.37             (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1] [4]

-----------------------------------------------------------------------------------

       1/1        94.37    94.37   10.73%     94.37    94.37             cool-peco [13]
 4)    1          94.37    94.37   10.73%     94.37    94.37   10.73%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]

-----------------------------------------------------------------------------------

       2/4        76.42    38.21    8.69%      0.39     0.19             compinit [2]
       2/4        76.03    38.02    8.65%     76.03    38.02             compaudit [5]
 5)    4          76.42    19.11    8.69%     76.42    19.11    8.69%  compaudit
       2/4        76.03    38.02    8.65%     76.03    38.02             compaudit [5]

-----------------------------------------------------------------------------------

       1/3         7.41     7.41    0.84%      0.97     0.97             pmodload [6]
       1/3         6.44     6.44    0.73%      6.44     6.44             promptinit [7]
 7)    3          11.62     3.87    1.32%     11.62     3.87    1.32%  promptinit
       1/3         6.44     6.44    0.73%      6.44     6.44             promptinit [7]

-----------------------------------------------------------------------------------

       1/2         1.79     1.79    0.20%      0.06     0.06             pmodload [6]
16)    2           2.48     1.24    0.28%      0.08     0.04    0.01%  prompt
       2/2         2.40     1.20    0.27%      0.26     0.13             set_prompt [14]

-----------------------------------------------------------------------------------

       2/2         2.40     1.20    0.27%      0.26     0.13             prompt [16]
14)    2           2.40     1.20    0.27%      0.26     0.13    0.03%  set_prompt
      14/19        0.65     0.05    0.07%      0.65     0.05             add-zsh-hook [10]
       2/3         0.68     0.34    0.08%      0.44     0.22             prompt_paradox_setup [12]
      14/15        0.81     0.06    0.09%      0.74     0.05             add-zle-hook-widget [11]

-----------------------------------------------------------------------------------

       1/3         0.05     0.05    0.01%      0.05     0.05             pmodload [6]
 8)    3           2.01     0.67    0.23%      2.01     0.67    0.23%  is-at-least

-----------------------------------------------------------------------------------

      10/10        1.72     0.17    0.20%      1.72     0.17             pmodload [6]
 9)   10           1.72     0.17    0.20%      1.72     0.17    0.20%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]

-----------------------------------------------------------------------------------

      14/19        0.65     0.05    0.07%      0.65     0.05             set_prompt [14]
       4/19        0.13     0.03    0.01%      0.13     0.03             prompt_paradox_setup [12]
10)   19           0.82     0.04    0.09%      0.82     0.04    0.09%  add-zsh-hook

-----------------------------------------------------------------------------------

      14/15        0.81     0.06    0.09%      0.74     0.05             set_prompt [14]
       1/15        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [11]
11)   15           0.81     0.05    0.09%      0.78     0.05    0.09%  add-zle-hook-widget
       1/1         0.03     0.03    0.00%      0.03     0.03             (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28] [19]
       1/15        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [11]

-----------------------------------------------------------------------------------

       2/3         0.68     0.34    0.08%      0.44     0.22             set_prompt [14]
       1/3         0.14     0.14    0.02%      0.08     0.08             prompt_paradox_setup [12]
12)    3           0.68     0.23    0.08%      0.52     0.17    0.06%  prompt_paradox_setup
       1/4         0.03     0.03    0.00%      0.03     0.03             pmodload [6]
       4/19        0.13     0.03    0.01%      0.13     0.03             add-zsh-hook [10]
       1/3         0.14     0.14    0.02%      0.08     0.08             prompt_paradox_setup [12]

-----------------------------------------------------------------------------------

15)    1           0.12     0.12    0.01%      0.12     0.12    0.01%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]

-----------------------------------------------------------------------------------

       1/1         0.04     0.04    0.01%      0.04     0.04             pmodload [6]
17)    1           0.04     0.04    0.01%      0.04     0.04    0.01%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]

-----------------------------------------------------------------------------------

18)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  iterm2_print_state_data
       1/1         0.00     0.00    0.00%      0.00     0.00             iterm2_print_user_vars [21]

-----------------------------------------------------------------------------------

       1/1         0.03     0.03    0.00%      0.03     0.03             add-zle-hook-widget [11]
19)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]

-----------------------------------------------------------------------------------

       1/1         0.02     0.02    0.00%      0.02     0.02             pmodload [6]
20)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable

-----------------------------------------------------------------------------------

       1/1         0.00     0.00    0.00%      0.00     0.00             iterm2_print_state_data [18]
21)    1           0.00     0.00    0.00%      0.00     0.00    0.00%  iterm2_print_user_vars
```

2回目

```
num  calls                time                       self            name
-----------------------------------------------------------------------------------
 1)    2         429.03   214.51   24.12%    425.14   212.57   23.90%  iterm2_print_user_vars
 2)    2         286.51   143.25   16.10%    286.51   143.25   16.10%  compdump
 3)    2         276.80   138.40   15.56%    276.76   138.38   15.56%  git-info
 4)    3         815.46   271.82   45.84%    233.98    77.99   13.15%  compinit
 5) 1883         163.82     0.09    9.21%    163.82     0.09    9.21%  compdef
 6)    6         131.15    21.86    7.37%    131.15    21.86    7.37%  compaudit
 7)    1          94.37    94.37    5.30%     94.37    94.37    5.30%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]
 8)    1          64.44    64.44    3.62%     64.44    64.44    3.62%  _direnv_hook
 9)    4          23.76     5.94    1.34%     23.76     5.94    1.34%  promptinit
10)    1          13.80    13.80    0.78%     13.80    13.80    0.78%  __vsc_update_cwd
11)    5         445.14    89.03   25.02%     12.40     2.48    0.70%  pmodload
12)  206           7.80     0.04    0.44%      6.52     0.03    0.37%  _zsh_autosuggest_bind_widget
13)    1           5.04     5.04    0.28%      5.04     5.04    0.28%  __vsc_command_output_start
14)    7           4.08     0.58    0.23%      4.08     0.58    0.23%  url-quote-magic
15)    2           4.04     2.02    0.23%      4.04     2.02    0.23%  _zsh_autosuggest_orig_reset-prompt
16)    1           3.89     3.89    0.22%      3.89     3.89    0.22%  iterm2_set_user_var
17)    1          11.23    11.23    0.63%      3.43     3.43    0.19%  _zsh_autosuggest_bind_widgets
18)    1           2.61     2.61    0.15%      2.61     2.61    0.15%  _zsh_autosuggest_orig_clear-screen
19)    7           2.41     0.34    0.14%      2.41     0.34    0.14%  is-at-least
20)    1           2.55     2.55    0.14%      2.37     2.37    0.13%  _zsh_autosuggest_async_request
21)    1           2.14     2.14    0.12%      2.14     2.14    0.12%  __vsc_update_prompt
22)   10           1.72     0.17    0.10%      1.72     0.17    0.10%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]
23)    1           1.60     1.60    0.09%      1.60     1.60    0.09%  iterm2_decorate_prompt
24)   12          13.26     1.10    0.75%      1.36     0.11    0.08%  _zsh_autosuggest_invoke_original_widget
25)  206           1.28     0.01    0.07%      1.28     0.01    0.07%  _zsh_autosuggest_incr_bind_count
26)   31           1.25     0.04    0.07%      1.25     0.04    0.07%  add-zsh-hook
27)   11          17.59     1.60    0.99%      1.20     0.11    0.07%  _zsh_autosuggest_widget_modify
28)    1         277.94   277.94   15.62%      1.13     1.13    0.06%  prompt_paradox_precmd
29)   22           1.01     0.05    0.06%      0.99     0.04    0.06%  add-zle-hook-widget
30)   11          16.27     1.48    0.91%      0.87     0.08    0.05%  _zsh_autosuggest_modify
31)    4           0.82     0.21    0.05%      0.60     0.15    0.03%  prompt_paradox_setup
32)    2          94.81    47.41    5.33%      0.44     0.22    0.02%  cool-peco
33)   13           0.40     0.03    0.02%      0.40     0.03    0.02%  _zsh_autosuggest_highlight_reset
34)    3           3.10     1.03    0.17%      0.39     0.13    0.02%  set_prompt
35)    1           0.42     0.42    0.02%      0.31     0.31    0.02%  _zsh_autosuggest_async_response
36)    6           8.78     1.46    0.49%      0.30     0.05    0.02%  _zsh_autosuggest_bound_1_self-insert
37)   13           0.27     0.02    0.02%      0.27     0.02    0.02%  _zsh_autosuggest_highlight_apply
38)    2           5.34     2.67    0.30%      0.26     0.13    0.01%  editor-info
39)    2           0.26     0.13    0.01%      0.26     0.13    0.01%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]
40)    1           4.19     4.19    0.24%      0.18     0.18    0.01%  zle-line-finish
41)    2           5.08     2.54    0.29%      0.18     0.09    0.01%  zle-reset-prompt
42)    1           0.51     0.51    0.03%      0.12     0.12    0.01%  _zsh_autosuggest_widget_clear
43)    3           3.21     1.07    0.18%      0.11     0.04    0.01%  prompt
44)    1           3.30     3.30    0.19%      0.08     0.08    0.00%  _zsh_autosuggest_bound_1_clear-screen
45)    1           0.59     0.59    0.03%      0.08     0.08    0.00%  _zsh_autosuggest_bound_1_accept-line
46)    1           2.01     2.01    0.11%      0.08     0.08    0.00%  zle-line-init
47)    2           4.90     2.45    0.28%      0.07     0.04    0.00%  _zsh_autosuggest_bound_1_reset-prompt
48)    1           0.11     0.11    0.01%      0.07     0.07    0.00%  _zsh_autosuggest_widget_suggest
49)    1          16.07    16.07    0.90%      0.07     0.07    0.00%  __vsc_precmd
50)    1         430.72   430.72   24.21%      0.06     0.06    0.00%  iterm2_precmd
51)    2           5.94     2.97    0.33%      0.05     0.03    0.00%  _zsh_autosuggest_bound_1_editor-info
52)    1           0.05     0.05    0.00%      0.05     0.05    0.00%  _zsh_autosuggest_orig_accept-line
53)    1           5.09     5.09    0.29%      0.05     0.05    0.00%  __vsc_preexec
54)    2           0.05     0.02    0.00%      0.05     0.02    0.00%  is-true
55)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]
56)    2         429.07   214.54   24.12%      0.04     0.02    0.00%  iterm2_print_state_data
57)    1           0.07     0.07    0.00%      0.04     0.04    0.00%  iterm2_preexec
58)    1           0.32     0.32    0.02%      0.04     0.04    0.00%  _zsh_autosuggest_clear
59)    1          13.83    13.83    0.78%      0.03     0.03    0.00%  __vsc_command_complete
60)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  __vsc_update_env
61)    1          11.26    11.26    0.63%      0.03     0.03    0.00%  _zsh_autosuggest_start
62)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]
63)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  prompt_paradox_preexec
64)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  iterm2_before_cmd_executes
65)    1         429.06   429.06   24.12%      0.02     0.02    0.00%  iterm2_after_cmd_executes
66)    1           2.56     2.56    0.14%      0.02     0.02    0.00%  _zsh_autosuggest_fetch
67)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable
68)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  prompt_paradox_print_elapsed_time
69)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  _zsh_autosuggest_suggest

-----------------------------------------------------------------------------------

       1/3       421.75   421.75   23.71%    148.44   148.44             pmodload [11]
 4)    3         815.46   271.82   45.84%    233.98    77.99   13.15%  compinit
       3/6       131.15    43.72    7.37%      0.57     0.19             compaudit [6]
    1883/1883    163.82     0.09    9.21%    163.82     0.09             compdef [5]
       2/2       286.51   143.25   16.10%    286.51   143.25             compdump [2]

-----------------------------------------------------------------------------------

       2/5         0.36     0.18    0.02%      0.32     0.16             pmodload [11]
       1/5         0.03     0.03    0.00%      0.03     0.03             prompt_paradox_setup [31]
11)    5         445.14    89.03   25.02%     12.40     2.48    0.70%  pmodload
       1/1         0.02     0.02    0.00%      0.02     0.02             is-callable [67]
       1/1         0.04     0.04    0.00%      0.04     0.04             (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114] [55]
       1/7         0.05     0.05    0.00%      0.05     0.05             is-at-least [19]
       2/5         0.36     0.18    0.02%      0.32     0.16             pmodload [11]
      10/10        1.72     0.17    0.10%      1.72     0.17             (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114] [22]
       1/3         1.79     1.79    0.10%      0.06     0.06             prompt [43]
       1/4         7.41     7.41    0.42%      0.97     0.97             promptinit [9]
       1/3       421.75   421.75   23.71%    148.44   148.44             compinit [4]

-----------------------------------------------------------------------------------

50)    1         430.72   430.72   24.21%      0.06     0.06    0.00%  iterm2_precmd
       1/1         1.60     1.60    0.09%      1.60     1.60             iterm2_decorate_prompt [23]
       1/1       429.06   429.06   24.12%      0.02     0.02             iterm2_after_cmd_executes [65]

-----------------------------------------------------------------------------------

       1/2       429.04   429.04   24.12%      0.02     0.02             iterm2_after_cmd_executes [65]
56)    2         429.07   214.54   24.12%      0.04     0.02    0.00%  iterm2_print_state_data
       2/2       429.03   214.51   24.12%    425.14   212.57             iterm2_print_user_vars [1]

-----------------------------------------------------------------------------------

       1/1       429.06   429.06   24.12%      0.02     0.02             iterm2_precmd [50]
65)    1         429.06   429.06   24.12%      0.02     0.02    0.00%  iterm2_after_cmd_executes
       1/2       429.04   429.04   24.12%      0.02     0.02             iterm2_print_state_data [56]

-----------------------------------------------------------------------------------

       2/2       429.03   214.51   24.12%    425.14   212.57             iterm2_print_state_data [56]
 1)    2         429.03   214.51   24.12%    425.14   212.57   23.90%  iterm2_print_user_vars
       1/1         3.89     3.89    0.22%      3.89     3.89             iterm2_set_user_var [16]

-----------------------------------------------------------------------------------

       2/2       286.51   143.25   16.10%    286.51   143.25             compinit [4]
 2)    2         286.51   143.25   16.10%    286.51   143.25   16.10%  compdump

-----------------------------------------------------------------------------------

28)    1         277.94   277.94   15.62%      1.13     1.13    0.06%  prompt_paradox_precmd
       1/1         0.01     0.01    0.00%      0.01     0.01             prompt_paradox_print_elapsed_time [68]
       1/2       276.80   276.80   15.56%      0.76     0.76             git-info [3]

-----------------------------------------------------------------------------------

       1/2       276.80   276.80   15.56%      0.76     0.76             prompt_paradox_precmd [28]
       1/2       276.04   276.04   15.52%    275.99   275.99             git-info [3]
 3)    2         276.80   138.40   15.56%    276.76   138.38   15.56%  git-info
       2/2         0.05     0.02    0.00%      0.05     0.02             is-true [54]
       1/2       276.04   276.04   15.52%    275.99   275.99             git-info [3]

-----------------------------------------------------------------------------------

    1883/1883    163.82     0.09    9.21%    163.82     0.09             compinit [4]
 5) 1883         163.82     0.09    9.21%    163.82     0.09    9.21%  compdef

-----------------------------------------------------------------------------------

       3/6       131.15    43.72    7.37%      0.57     0.19             compinit [4]
       3/6       130.58    43.53    7.34%    130.58    43.53             compaudit [6]
 6)    6         131.15    21.86    7.37%    131.15    21.86    7.37%  compaudit
       3/6       130.58    43.53    7.34%    130.58    43.53             compaudit [6]

-----------------------------------------------------------------------------------

32)    2          94.81    47.41    5.33%      0.44     0.22    0.02%  cool-peco
       1/1        94.37    94.37    5.30%     94.37    94.37             (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1] [7]

-----------------------------------------------------------------------------------

       1/1        94.37    94.37    5.30%     94.37    94.37             cool-peco [32]
 7)    1          94.37    94.37    5.30%     94.37    94.37    5.30%  (anon) [/Users/noriyo_tcp/cool-peco/cool-peco:1]

-----------------------------------------------------------------------------------

 8)    1          64.44    64.44    3.62%     64.44    64.44    3.62%  _direnv_hook

-----------------------------------------------------------------------------------

       1/4         7.41     7.41    0.42%      0.97     0.97             pmodload [11]
       1/4         6.44     6.44    0.36%      6.44     6.44             promptinit [9]
 9)    4          23.76     5.94    1.34%     23.76     5.94    1.34%  promptinit
       1/4         6.44     6.44    0.36%      6.44     6.44             promptinit [9]

-----------------------------------------------------------------------------------

       6/11        8.49     1.41    0.48%      0.51     0.09             _zsh_autosuggest_bound_1_self-insert [36]
       2/11        5.88     2.94    0.33%      0.10     0.05             _zsh_autosuggest_bound_1_editor-info [51]
       2/11        4.82     2.41    0.27%      0.37     0.19             _zsh_autosuggest_bound_1_reset-prompt [47]
       1/11        3.22     3.22    0.18%      0.21     0.21             _zsh_autosuggest_bound_1_clear-screen [44]
27)   11          17.59     1.60    0.99%      1.20     0.11    0.07%  _zsh_autosuggest_widget_modify
      11/13        0.22     0.02    0.01%      0.22     0.02             _zsh_autosuggest_highlight_apply [37]
      11/13        0.36     0.03    0.02%      0.36     0.03             _zsh_autosuggest_highlight_reset [33]
      11/11       20.62     1.87    1.16%      0.87     0.08             _zsh_autosuggest_modify [30]

-----------------------------------------------------------------------------------

      11/11       20.62     1.87    1.16%      0.87     0.08             _zsh_autosuggest_widget_modify [27]
30)   11          16.27     1.48    0.91%      0.87     0.08    0.05%  _zsh_autosuggest_modify
       1/1         2.56     2.56    0.14%      0.02     0.02             _zsh_autosuggest_fetch [66]
      11/12       17.19     1.56    0.97%      1.13     0.10             _zsh_autosuggest_invoke_original_widget [24]

-----------------------------------------------------------------------------------

49)    1          16.07    16.07    0.90%      0.07     0.07    0.00%  __vsc_precmd
       1/1         0.03     0.03    0.00%      0.03     0.03             __vsc_update_env [60]
       1/1         2.14     2.14    0.12%      2.14     2.14             __vsc_update_prompt [21]
       1/1        13.83    13.83    0.78%      0.03     0.03             __vsc_command_complete [59]

-----------------------------------------------------------------------------------

       1/1        13.83    13.83    0.78%      0.03     0.03             __vsc_precmd [49]
59)    1          13.83    13.83    0.78%      0.03     0.03    0.00%  __vsc_command_complete
       1/1        13.80    13.80    0.78%     13.80    13.80             __vsc_update_cwd [10]

-----------------------------------------------------------------------------------

       1/1        13.80    13.80    0.78%     13.80    13.80             __vsc_command_complete [59]
10)    1          13.80    13.80    0.78%     13.80    13.80    0.78%  __vsc_update_cwd

-----------------------------------------------------------------------------------

      11/12       17.19     1.56    0.97%      1.13     0.10             _zsh_autosuggest_modify [30]
       1/12        0.29     0.29    0.02%      0.23     0.23             _zsh_autosuggest_clear [58]
24)   12          13.26     1.10    0.75%      1.36     0.11    0.08%  _zsh_autosuggest_invoke_original_widget
       1/1         0.05     0.05    0.00%      0.05     0.05             _zsh_autosuggest_orig_accept-line [52]
       1/1         2.61     2.61    0.15%      2.61     2.61             _zsh_autosuggest_orig_clear-screen [18]
       2/2         4.04     2.02    0.23%      4.04     2.02             _zsh_autosuggest_orig_reset-prompt [15]
       6/7         4.08     0.68    0.23%      4.05     0.67             url-quote-magic [14]
       2/2         5.34     2.67    0.30%      0.26     0.13             editor-info [38]

-----------------------------------------------------------------------------------

61)    1          11.26    11.26    0.63%      0.03     0.03    0.00%  _zsh_autosuggest_start
       1/1        11.23    11.23    0.63%      3.43     3.43             _zsh_autosuggest_bind_widgets [17]

-----------------------------------------------------------------------------------

       1/1        11.23    11.23    0.63%      3.43     3.43             _zsh_autosuggest_start [61]
17)    1          11.23    11.23    0.63%      3.43     3.43    0.19%  _zsh_autosuggest_bind_widgets
     206/206       7.80     0.04    0.44%      6.52     0.03             _zsh_autosuggest_bind_widget [12]

-----------------------------------------------------------------------------------

36)    6           8.78     1.46    0.49%      0.30     0.05    0.02%  _zsh_autosuggest_bound_1_self-insert
       6/11        8.49     1.41    0.48%      0.51     0.09             _zsh_autosuggest_widget_modify [27]

-----------------------------------------------------------------------------------

     206/206       7.80     0.04    0.44%      6.52     0.03             _zsh_autosuggest_bind_widgets [17]
12)  206           7.80     0.04    0.44%      6.52     0.03    0.37%  _zsh_autosuggest_bind_widget
     206/206       1.28     0.01    0.07%      1.28     0.01             _zsh_autosuggest_incr_bind_count [25]

-----------------------------------------------------------------------------------

       1/2         4.01     4.01    0.23%      0.03     0.03             zle-line-finish [40]
       1/2         1.93     1.93    0.11%      0.03     0.03             zle-line-init [46]
51)    2           5.94     2.97    0.33%      0.05     0.03    0.00%  _zsh_autosuggest_bound_1_editor-info
       2/11        5.88     2.94    0.33%      0.10     0.05             _zsh_autosuggest_widget_modify [27]

-----------------------------------------------------------------------------------

       2/2         5.34     2.67    0.30%      0.26     0.13             _zsh_autosuggest_invoke_original_widget [24]
38)    2           5.34     2.67    0.30%      0.26     0.13    0.01%  editor-info
       2/2         5.08     2.54    0.29%      0.18     0.09             zle-reset-prompt [41]

-----------------------------------------------------------------------------------

53)    1           5.09     5.09    0.29%      0.05     0.05    0.00%  __vsc_preexec
       1/1         5.04     5.04    0.28%      5.04     5.04             __vsc_command_output_start [13]

-----------------------------------------------------------------------------------

       2/2         5.08     2.54    0.29%      0.18     0.09             editor-info [38]
41)    2           5.08     2.54    0.29%      0.18     0.09    0.01%  zle-reset-prompt
       2/2         4.90     2.45    0.28%      0.07     0.04             _zsh_autosuggest_bound_1_reset-prompt [47]

-----------------------------------------------------------------------------------

       1/1         5.04     5.04    0.28%      5.04     5.04             __vsc_preexec [53]
13)    1           5.04     5.04    0.28%      5.04     5.04    0.28%  __vsc_command_output_start

-----------------------------------------------------------------------------------

       2/2         4.90     2.45    0.28%      0.07     0.04             zle-reset-prompt [41]
47)    2           4.90     2.45    0.28%      0.07     0.04    0.00%  _zsh_autosuggest_bound_1_reset-prompt
       2/11        4.82     2.41    0.27%      0.37     0.19             _zsh_autosuggest_widget_modify [27]

-----------------------------------------------------------------------------------

40)    1           4.19     4.19    0.24%      0.18     0.18    0.01%  zle-line-finish
       1/2         4.01     4.01    0.23%      0.03     0.03             _zsh_autosuggest_bound_1_editor-info [51]

-----------------------------------------------------------------------------------

       6/7         4.08     0.68    0.23%      4.05     0.67             _zsh_autosuggest_invoke_original_widget [24]
       1/7         0.03     0.03    0.00%      0.03     0.03             url-quote-magic [14]
14)    7           4.08     0.58    0.23%      4.08     0.58    0.23%  url-quote-magic
       1/7         0.03     0.03    0.00%      0.03     0.03             url-quote-magic [14]

-----------------------------------------------------------------------------------

       2/2         4.04     2.02    0.23%      4.04     2.02             _zsh_autosuggest_invoke_original_widget [24]
15)    2           4.04     2.02    0.23%      4.04     2.02    0.23%  _zsh_autosuggest_orig_reset-prompt

-----------------------------------------------------------------------------------

       1/1         3.89     3.89    0.22%      3.89     3.89             iterm2_print_user_vars [1]
16)    1           3.89     3.89    0.22%      3.89     3.89    0.22%  iterm2_set_user_var

-----------------------------------------------------------------------------------

44)    1           3.30     3.30    0.19%      0.08     0.08    0.00%  _zsh_autosuggest_bound_1_clear-screen
       1/11        3.22     3.22    0.18%      0.21     0.21             _zsh_autosuggest_widget_modify [27]

-----------------------------------------------------------------------------------

       1/3         1.79     1.79    0.10%      0.06     0.06             pmodload [11]
43)    3           3.21     1.07    0.18%      0.11     0.04    0.01%  prompt
       3/3         3.10     1.03    0.17%      0.39     0.13             set_prompt [34]

-----------------------------------------------------------------------------------

       3/3         3.10     1.03    0.17%      0.39     0.13             prompt [43]
34)    3           3.10     1.03    0.17%      0.39     0.13    0.02%  set_prompt
       3/4         0.82     0.27    0.05%      0.52     0.17             prompt_paradox_setup [31]
      21/31        0.87     0.04    0.05%      0.87     0.04             add-zsh-hook [26]
      21/22        1.01     0.05    0.06%      0.95     0.05             add-zle-hook-widget [29]

-----------------------------------------------------------------------------------

       1/1         2.61     2.61    0.15%      2.61     2.61             _zsh_autosuggest_invoke_original_widget [24]
18)    1           2.61     2.61    0.15%      2.61     2.61    0.15%  _zsh_autosuggest_orig_clear-screen

-----------------------------------------------------------------------------------

       1/1         2.56     2.56    0.14%      0.02     0.02             _zsh_autosuggest_modify [30]
66)    1           2.56     2.56    0.14%      0.02     0.02    0.00%  _zsh_autosuggest_fetch
       1/1         2.55     2.55    0.14%      2.37     2.37             _zsh_autosuggest_async_request [20]

-----------------------------------------------------------------------------------

       1/1         2.55     2.55    0.14%      2.37     2.37             _zsh_autosuggest_fetch [66]
20)    1           2.55     2.55    0.14%      2.37     2.37    0.13%  _zsh_autosuggest_async_request
       1/7         0.18     0.18    0.01%      0.18     0.18             is-at-least [19]

-----------------------------------------------------------------------------------

       1/7         0.18     0.18    0.01%      0.18     0.18             _zsh_autosuggest_async_request [20]
       1/7         0.05     0.05    0.00%      0.05     0.05             pmodload [11]
19)    7           2.41     0.34    0.14%      2.41     0.34    0.14%  is-at-least

-----------------------------------------------------------------------------------

       1/1         2.14     2.14    0.12%      2.14     2.14             __vsc_precmd [49]
21)    1           2.14     2.14    0.12%      2.14     2.14    0.12%  __vsc_update_prompt

-----------------------------------------------------------------------------------

46)    1           2.01     2.01    0.11%      0.08     0.08    0.00%  zle-line-init
       1/2         1.93     1.93    0.11%      0.03     0.03             _zsh_autosuggest_bound_1_editor-info [51]

-----------------------------------------------------------------------------------

      10/10        1.72     0.17    0.10%      1.72     0.17             pmodload [11]
22)   10           1.72     0.17    0.10%      1.72     0.17    0.10%  (anon) [/Users/noriyo_tcp/.zprezto/init.zsh:114]

-----------------------------------------------------------------------------------

       1/1         1.60     1.60    0.09%      1.60     1.60             iterm2_precmd [50]
23)    1           1.60     1.60    0.09%      1.60     1.60    0.09%  iterm2_decorate_prompt

-----------------------------------------------------------------------------------

     206/206       1.28     0.01    0.07%      1.28     0.01             _zsh_autosuggest_bind_widget [12]
25)  206           1.28     0.01    0.07%      1.28     0.01    0.07%  _zsh_autosuggest_incr_bind_count

-----------------------------------------------------------------------------------

      21/31        0.87     0.04    0.05%      0.87     0.04             set_prompt [34]
       6/31        0.19     0.03    0.01%      0.19     0.03             prompt_paradox_setup [31]
26)   31           1.25     0.04    0.07%      1.25     0.04    0.07%  add-zsh-hook

-----------------------------------------------------------------------------------

      21/22        1.01     0.05    0.06%      0.95     0.05             set_prompt [34]
       1/22        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [29]
29)   22           1.01     0.05    0.06%      0.99     0.04    0.06%  add-zle-hook-widget
       1/1         0.03     0.03    0.00%      0.03     0.03             (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28] [62]
       1/22        0.04     0.04    0.00%      0.04     0.04             add-zle-hook-widget [29]

-----------------------------------------------------------------------------------

       3/4         0.82     0.27    0.05%      0.52     0.17             set_prompt [34]
       1/4         0.14     0.14    0.01%      0.08     0.08             prompt_paradox_setup [31]
31)    4           0.82     0.21    0.05%      0.60     0.15    0.03%  prompt_paradox_setup
       1/5         0.03     0.03    0.00%      0.03     0.03             pmodload [11]
       1/4         0.14     0.14    0.01%      0.08     0.08             prompt_paradox_setup [31]
       6/31        0.19     0.03    0.01%      0.19     0.03             add-zsh-hook [26]

-----------------------------------------------------------------------------------

45)    1           0.59     0.59    0.03%      0.08     0.08    0.00%  _zsh_autosuggest_bound_1_accept-line
       1/1         0.51     0.51    0.03%      0.12     0.12             _zsh_autosuggest_widget_clear [42]

-----------------------------------------------------------------------------------

       1/1         0.51     0.51    0.03%      0.12     0.12             _zsh_autosuggest_bound_1_accept-line [45]
42)    1           0.51     0.51    0.03%      0.12     0.12    0.01%  _zsh_autosuggest_widget_clear
       1/13        0.03     0.03    0.00%      0.03     0.03             _zsh_autosuggest_highlight_apply [37]
       1/13        0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_highlight_reset [33]
       1/1         0.32     0.32    0.02%      0.04     0.04             _zsh_autosuggest_clear [58]

-----------------------------------------------------------------------------------

35)    1           0.42     0.42    0.02%      0.31     0.31    0.02%  _zsh_autosuggest_async_response
       1/1         0.11     0.11    0.01%      0.07     0.07             _zsh_autosuggest_widget_suggest [48]

-----------------------------------------------------------------------------------

      11/13        0.36     0.03    0.02%      0.36     0.03             _zsh_autosuggest_widget_modify [27]
       1/13        0.04     0.04    0.00%      0.04     0.04             _zsh_autosuggest_widget_clear [42]
       1/13        0.01     0.01    0.00%      0.01     0.01             _zsh_autosuggest_widget_suggest [48]
33)   13           0.40     0.03    0.02%      0.40     0.03    0.02%  _zsh_autosuggest_highlight_reset

-----------------------------------------------------------------------------------

       1/1         0.32     0.32    0.02%      0.04     0.04             _zsh_autosuggest_widget_clear [42]
58)    1           0.32     0.32    0.02%      0.04     0.04    0.00%  _zsh_autosuggest_clear
       1/12        0.29     0.29    0.02%      0.23     0.23             _zsh_autosuggest_invoke_original_widget [24]

-----------------------------------------------------------------------------------

      11/13        0.22     0.02    0.01%      0.22     0.02             _zsh_autosuggest_widget_modify [27]
       1/13        0.03     0.03    0.00%      0.03     0.03             _zsh_autosuggest_widget_clear [42]
       1/13        0.02     0.02    0.00%      0.02     0.02             _zsh_autosuggest_widget_suggest [48]
37)   13           0.27     0.02    0.02%      0.27     0.02    0.02%  _zsh_autosuggest_highlight_apply

-----------------------------------------------------------------------------------

39)    2           0.26     0.13    0.01%      0.26     0.13    0.01%  (anon) [/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh:458]

-----------------------------------------------------------------------------------

       1/1         0.11     0.11    0.01%      0.07     0.07             _zsh_autosuggest_async_response [35]
48)    1           0.11     0.11    0.01%      0.07     0.07    0.00%  _zsh_autosuggest_widget_suggest
       1/13        0.01     0.01    0.00%      0.01     0.01             _zsh_autosuggest_highlight_reset [33]
       1/1         0.01     0.01    0.00%      0.01     0.01             _zsh_autosuggest_suggest [69]
       1/13        0.02     0.02    0.00%      0.02     0.02             _zsh_autosuggest_highlight_apply [37]

-----------------------------------------------------------------------------------

57)    1           0.07     0.07    0.00%      0.04     0.04    0.00%  iterm2_preexec
       1/1         0.02     0.02    0.00%      0.02     0.02             iterm2_before_cmd_executes [64]

-----------------------------------------------------------------------------------

       1/1         0.05     0.05    0.00%      0.05     0.05             _zsh_autosuggest_invoke_original_widget [24]
52)    1           0.05     0.05    0.00%      0.05     0.05    0.00%  _zsh_autosuggest_orig_accept-line

-----------------------------------------------------------------------------------

       2/2         0.05     0.02    0.00%      0.05     0.02             git-info [3]
54)    2           0.05     0.02    0.00%      0.05     0.02    0.00%  is-true

-----------------------------------------------------------------------------------

       1/1         0.04     0.04    0.00%      0.04     0.04             pmodload [11]
55)    1           0.04     0.04    0.00%      0.04     0.04    0.00%  (anon) [/Users/noriyo_tcp/.zprezto/modules/utility/init.zsh:114]

-----------------------------------------------------------------------------------

       1/1         0.03     0.03    0.00%      0.03     0.03             __vsc_precmd [49]
60)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  __vsc_update_env

-----------------------------------------------------------------------------------

       1/1         0.03     0.03    0.00%      0.03     0.03             add-zle-hook-widget [29]
62)    1           0.03     0.03    0.00%      0.03     0.03    0.00%  (anon) [/usr/share/zsh/5.9/functions/add-zle-hook-widget:28]

-----------------------------------------------------------------------------------

63)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  prompt_paradox_preexec

-----------------------------------------------------------------------------------

       1/1         0.02     0.02    0.00%      0.02     0.02             iterm2_preexec [57]
64)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  iterm2_before_cmd_executes

-----------------------------------------------------------------------------------

       1/1         0.02     0.02    0.00%      0.02     0.02             pmodload [11]
67)    1           0.02     0.02    0.00%      0.02     0.02    0.00%  is-callable

-----------------------------------------------------------------------------------

       1/1         0.01     0.01    0.00%      0.01     0.01             prompt_paradox_precmd [28]
68)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  prompt_paradox_print_elapsed_time

-----------------------------------------------------------------------------------

       1/1         0.01     0.01    0.00%      0.01     0.01             _zsh_autosuggest_widget_suggest [48]
69)    1           0.01     0.01    0.00%      0.01     0.01    0.00%  _zsh_autosuggest_suggest
```

少しは早くなった気がするけど、うーん。

```
 ❯ for i in $(seq 1 10); do time zsh -i -c exit; done
Agent pid 17158
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.34s user 0.94s system 82% cpu 2.749 total
Agent pid 17323
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  0.97s user 0.66s system 84% cpu 1.940 total
Agent pid 17459
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  0.99s user 0.67s system 85% cpu 1.942 total
Agent pid 17597
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.05s user 0.68s system 85% cpu 2.027 total
Agent pid 17905
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.17s user 0.76s system 85% cpu 2.264 total
Agent pid 18041
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.11s user 0.82s system 78% cpu 2.456 total
Agent pid 18187
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.07s user 0.76s system 82% cpu 2.219 total
Agent pid 18329
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.02s user 0.66s system 85% cpu 1.971 total
Agent pid 18464
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.13s user 0.74s system 84% cpu 2.198 total
Agent pid 18772
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.32s user 0.96s system 61% cpu 3.726 total
```

backup と、再生成したダンプファイルだとサイズがあまり変わらないんじゃないかなあ？

```
 ❯ ls -la ~ | grep zcompdump
-rw-r--r--     1 noriyo_tcp  staff    54355 Sep 23 10:46 .zcompdump
-rw-r--r--     1 noriyo_tcp  staff    54195 Sep 23 10:21 .zcompdump.bak
```

おっしゃる通り、.zcompdumpのファイルサイズはほとんど変わっていませんね。これは、キャッシュされる補完の定義数自体は、再作成する前と後でほぼ同じだった、ということを示しています。

一方で、timeコマンドの結果を見ると、平均起動時間は改善しているように見えます。

- 対策前: 6.4秒台の初回起動を除くと、平均 約3.3秒
- 対策後: 2.7秒台の初回起動を含めても、平均 約2.3秒

キャッシュの再作成によって、読み込み処理は何らかの形で効率化されたようです。これは良い兆候です。

しかし、まだ2秒以上かかっており、根本的な解決には至っていません。プロファイル結果を見ると、依然としてcompinitやcompdef、そしてiterm2_print_user_va
rsやgit-infoといった処理が時間を占めています。

ファイルサイズが変わらなかったことから、問題は「キャッシュの破損」ではなく「読み込んでいる補完の定義が多すぎること」そのものである可能性が高いです。

次の対策：不要な補完定義を読み込まないようにする

そこで、次のステップとして、zshのフレームワークであるPreztoの設定を見直し、不要な補完を読み込まないようにして、compdefの呼び出し回数自体を減らすことを試みましょう。

具体的には、~/.zpreztorcファイルを確認し、使用していないモジュールを無効化することを検討します。

```
Shell cat ~/.zpreztorc
```

どうしても completion に時間がかかるようだ。大量の補完候補があるため（？）

---
~/.zshrc

```zsh
# Asynchronous compinit for faster startup
# Based on https://gist.github.com/ctechols/ca1035271ad134841284
autoload -Uz compinit
if [[ -n "$PS1" ]]; then
  # キャッシュファイルが10時間以内に更新されていれば、
  # それを読み込み、裏で新しいキャッシュを生成する
  if [[ -s "${ZDOTDIR:-$HOME}/.zcompdump" && "$(($(date +%s) - $(stat -f %m "${ZDOTDIR:-$HOME}/.zcompdump")))" -lt 36000 ]]; then
    compinit -i -d "${ZDOTDIR:-$HOME}/.zcompdump"
    ( compinit -C -d "${ZDOTDIR:-$HOME}/.zcompdump" & )
  # そうでなければ、キャッシュを生成する（初回起動など）
  else
    compinit -C -d "${ZDOTDIR:-$HOME}/.zcompdump"
  fi
fi
```

そんなに速くなっていないかなあ？

```
 ❯ for i in $(seq 1 10); do time zsh -i -c exit; done
Agent pid 77603
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.59s user 1.01s system 89% cpu 2.897 total
Agent pid 77947
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.74s user 1.11s system 89% cpu 3.180 total
Agent pid 78123
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.48s user 0.94s system 89% cpu 2.702 total
Agent pid 78294
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.59s user 1.01s system 83% cpu 3.102 total
Agent pid 78467
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.87s user 1.30s system 70% cpu 4.480 total
Agent pid 78815
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.64s user 1.10s system 87% cpu 3.123 total
Agent pid 78993
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.53s user 1.02s system 89% cpu 2.860 total
Agent pid 79162
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.74s user 1.15s system 89% cpu 3.221 total
Agent pid 79508
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.62s user 1.08s system 89% cpu 3.006 total
Agent pid 79683
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.51s user 0.97s system 88% cpu 2.822 total
```

---

今度は `iterm2_print_user_vars` について調べる。
~/.zshrc

```zsh
# source ~/.iterm2_shell_integration.zsh
```

これでまた調べてみる。

```
 ❯ for i in $(seq 1 10); do time zsh -i -c exit; done
Agent pid 87615
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.88s user 1.27s system 83% cpu 3.766 total
Agent pid 87800
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.66s user 1.10s system 87% cpu 3.155 total
Agent pid 87972
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.76s user 1.16s system 80% cpu 3.630 total
Agent pid 88320
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.16s user 1.55s system 74% cpu 5.008 total
Agent pid 88522
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.84s user 1.26s system 82% cpu 3.771 total
Agent pid 88869
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.50s user 1.89s system 59% cpu 7.387 total
Agent pid 89054
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.87s user 1.27s system 83% cpu 3.743 total
Agent pid 89401
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.93s user 1.32s system 79% cpu 4.071 total
Agent pid 89587
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.61s user 1.02s system 89% cpu 2.935 total
Agent pid 89754
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.80s user 1.17s system 85% cpu 3.461 total
```

---

リセット手順

   1. `~/.zshrc` の修正:
       - 前回追加した非同期読み込みスクリプトを完全に削除してください。
       - コメントアウトした source ~/.iterm2_shell_integration.zsh
         の行を元に戻し、有効化してください（行頭の#を削除）。

   2. `~/.zpreztorc` の確認:
       - このファイルは、completion
         モジュールが有効になっている、元の状態のままでお願いします。

   3. 補完キャッシュの再作成:
       - 念のため、もう一度補完キャッシュを削除します。以下のコマンドを実行し
         てください。

`Shell rm -f ~/.zcompdump*`

```
zsh -i -c exit  2.18s user 1.55s system 79% cpu 4.674 total
Agent pid 95969
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.05s user 1.38s system 80% cpu 4.230 total
Agent pid 96145
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.88s user 1.33s system 80% cpu 3.964 total
Agent pid 96318
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.07s user 1.39s system 86% cpu 3.984 total
Agent pid 96494
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.23s user 1.51s system 85% cpu 4.398 total
Agent pid 96852
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.27s user 1.53s system 81% cpu 4.645 total
Agent pid 97027
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.65s user 1.09s system 87% cpu 3.115 total
Agent pid 97204
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.72s user 1.10s system 90% cpu 3.117 total
Agent pid 97550
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.70s user 1.12s system 87% cpu 3.208 total
Agent pid 97729
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.63s user 1.11s system 67% cpu 4.049 total
```

---

  次のステップ：iTerm2連携の無効化

  最初のプロファイル結果で、compinitの次に起動時間を消費していたのは
  `iterm2_print_user_vars` でした。これはiTerm2連携機能の一部です。

  まずは、この機能だけを無効化して、効果を正確に測定します。

   1. ~/.zshrc ファイルを開いてください。
   2. source ~/.iterm2_shell_integration.zsh という行の先頭に #
      を付けて、コメントアウトしてください。

  変更前:
   1 source ~/.iterm2_shell_integration.zsh

  変更後:

   1 # source ~/.iterm2_shell_integration.zsh

  以前にも試しましたが、今回は他の設定がリセットされているため、この変更単
  体での正確な効果が測れるはずです。

  変更を保存した後、新しいターミナルで再度 time コマンドによる10回の計測を
  お願いします。今度こそ、明確な改善が見られることを期待しましょう。

```
zsh -i -c exit  2.03s user 1.35s system 82% cpu 4.095 total
Agent pid 1904
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.79s user 1.21s system 89% cpu 3.368 total
Agent pid 2095
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.59s user 1.02s system 90% cpu 2.895 total
Agent pid 2282
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.85s user 1.21s system 89% cpu 3.418 total
Agent pid 2633
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.78s user 1.15s system 89% cpu 3.273 total
Agent pid 2813
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.75s user 1.19s system 85% cpu 3.427 total
Agent pid 2993
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.77s user 1.12s system 83% cpu 3.474 total
Agent pid 3359
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.92s user 1.29s system 78% cpu 4.069 total
Agent pid 3547
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.93s user 1.36s system 75% cpu 4.373 total
Agent pid 3856
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  1.90s user 1.23s system 84% cpu 3.706 total
```

---

  次のステップ： git-info の無効化

  この調子で、次のボトルネックを解消していきましょう。

  プロファイル結果で次に時間を消費していたのは `git-info`
  です。これは、Preztoの git モジュールが、プロンプトに現在のブランチ名など
  を表示するために呼び出している機能です。特に、リポジトリが大きかったりす
  ると、この処理が重くなることがあります。

  この git モジュールを一時的に無効化して、効果を測定してみましょう。

   1. ~/.zpreztorc ファイルを開いてください。
   2. pmodule のリストの中から、'git' の行の先頭に #
      を付けてコメントアウトしてください。


```
zsh -i -c exit  1.59s user 1.03s system 59% cpu 4.387 total
zsh -i -c exit  1.64s user 1.11s system 85% cpu 3.209 total
zsh -i -c exit  1.47s user 0.95s system 89% cpu 2.700 total
zsh -i -c exit  1.48s user 0.98s system 89% cpu 2.742 total
zsh -i -c exit  1.75s user 1.08s system 89% cpu 3.148 total
zsh -i -c exit  1.50s user 1.00s system 89% cpu 2.790 total
zsh -i -c exit  1.52s user 0.98s system 88% cpu 2.817 total
zsh -i -c exit  1.61s user 1.03s system 90% cpu 2.926 total
zsh -i -c exit  1.63s user 1.08s system 89% cpu 3.040 total
zsh -i -c exit  1.46s user 0.97s system 89% cpu 2.723 total
```

---

powerlevel10k も試してみる。

Powerlevel10k 導入手順

  手順1：設定の事前準備

  まず、これまでの実験で変更した設定を、一度Preztoの標準的な状態に戻します
  。

   1. ~/.zpreztorc を開き、前回コメントアウトした'git'モジュールの行を有効に
      戻してください。

   2. ~/.zshrc を開き、前回コメントアウトしたsource 
      ~/.iterm2_shell_integration.zshの行も有効に戻してください。

  この時点では、シェルの起動は遅い状態に戻りますが、ここから確実に高速化して
  いきます。

  手順2：Powerlevel10kのインストール

```
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/powerlevel10k
```

手順2：Preztoの設定変更

   1. ~/.zpreztorc ファイルを開いてください。
   2. `git`モジュールを無効化します。'git'の行をコメントアウトしてください。
   3. プロンプトテーマを`powerlevel10k`に変更します。zstyle 
      ':prezto:module:prompt' theme
      'paradox'の行を、'powerlevel10k'に書き換えてください。

  変更前:

   1 zstyle ':prezto:load' pmodule \
   2   ...
   3   'git' \
   4   'prompt'
   5 
   6 ...
   7 
   8 zstyle ':prezto:module:prompt' theme 'paradox'

  変更後:

   1 zstyle ':prezto:load' pmodule \
   2   ...
   3   # 'git' \
   4   'prompt'
   5 
   6 ...
   7 
   8 zstyle ':prezto:module:prompt' theme 'powerlevel10k'
  この設定により、Preztoのpromptモジュールが、ダウンロードしたPowerlevel10k
  をテーマとして読み込みにいきます。.zshrcにsource行を追加する必要はありま
  せん。

~/.zshrc にパスを通していないからテーマが見つからないのでは？
直接 git clone より Homebrew にしようかな。

https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#homebrew

```
brew install powerlevel10k
echo "source $(brew --prefix)/share/powerlevel10k/powerlevel10k.zsh-theme" >>~/.zshrc
```

再起動すると。。。

```
[powerlevel10k] fetching gitstatusd .. [ok]                                                                                                                                  
 noriyo_tcp@MacBook-Air  ~/MyPlayground/til   main ? ⍟2  
 ```
 
 ---
 
 再計測
 
 ```
 zsh -i -c exit  2.06s user 1.51s system 65% cpu 5.443 total
Agent pid 59107
Identity added: /Users/noriyo_tcp/.ssh/github_rsa (/Users/noriyo_tcp/.ssh/github_rsa)
zsh -i -c exit  2.06s user 1.51s system 65% cpu 5.443 total
zsh -i -c exit  1.71s user 1.15s system 82% cpu 3.455 total
zsh -i -c exit  1.70s user 1.08s system 87% cpu 3.170 total
zsh -i -c exit  1.91s user 1.30s system 78% cpu 4.060 total
zsh -i -c exit  2.22s user 1.48s system 83% cpu 4.430 total
zsh -i -c exit  1.79s user 1.17s system 87% cpu 3.366 total
zsh -i -c exit  1.97s user 1.33s system 83% cpu 3.946 total
zsh -i -c exit  1.82s user 1.23s system 86% cpu 3.518 total
zsh -i -c exit  1.65s user 1.05s system 88% cpu 3.072 total
zsh -i -c exit  1.90s user 1.23s system 88% cpu 3.525 total
```

---

最終クリーンアップ手順

  手順1： .zpreztorc の修正

  まず、Preztoの設定ファイルから、Powerlevel10kが代替するモジュールを無
  効化します。

   1. ~/.zpreztorc を開いてください。
   2. pmodule のリストから、'git' と 'prompt' の2つをコメントアウトします。
   3. zstyle を使ったテーマ設定の行も、Powerlevel10kが独自に処理するため不
      要です。これもコメントアウトしてください。

  修正後の `.zpreztorc` の該当部分:

    1 # Set the Prezto modules to load (browse modules).
    2 # The order matters.
    3 zstyle ':prezto:load' pmodule \
    4   'environment' \
    5   'terminal' \
    6   'editor' \
    7   'history' \
    8   'directory' \
    9   'spectrum' \
   10   'utility' \
   11   'completion' \
   12   # 'git' \
   13   # 'prompt'
   14 
   15 ...
   16 # (ファイルの末尾にあるかもしれない以下の行もコメントアウト)
   17 # zstyle ':prezto:module:prompt' theme 'powerlevel10k'
   18 # zstyle ':prezto:module:prompt' theme 'paradox'

  手順2： .zshrc のクリーンアップ

  次に、.zshrc の内容を、競合する設定を削除し、正しい順序に整理したもの
  に置き換えます。

  現在の .zshrc の内容を、以下の修正版の全内容に置き換えてください。

```zsh
#
# PreztoとPowerlevel10kに最適化された設定
#
# Preztoの読み込み
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Powerlevel10kの読み込み
# (必ずPreztoの後、かつファイルの最後に記述)
if [[ -r "${XDG_CACHE_HOME:-$HOME}/.cache/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME}/.cache/p10k-instant-prompt-${(%):-%n}.zsh"
fi
source "$(brew --prefix)/share/powerlevel10k/powerlevel10k.zsh-theme"

# --- 以下、個人の設定 ---

# エイリアス
alias java8='java -encoding UTF-8'
alias javac8='javac -encoding UTF-8'
alias brew="PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin brew"
alias rppc='find . -name .git -type d -prune -exec dirname {} \\; | peco'
alias reload='source ~/.zshrc'
alias ghc='stack ghc --'
alias ghci='stack ghci --'
alias runhaskell='stack runhaskell --'

# キーバインド
bindkey '^r' cool-peco-history # ctrl+r

# ASDF
export ASDF_DATA_DIR=/Users/noriyo_tcp/.asdf
export PATH="${ASDF_DATA_DIR:-$HOME/.asdf}/shims:$PATH"
fpath=(${ASDF_DATA_DIR}/completions $fpath)

# 各種ツールの設定
eval "$(direnv hook zsh)"
eval "$(rbenv init -)"
. "$HOME/.cargo/env"

# iTerm2連携 (これが不要であれば、以下の2行をコメントアウト)
source ~/.iterm2_shell_integration.zsh
iterm2_print_user_vars

# cool-peco
FPATH="$FPATH:/Users/noriyo_tcp/cool-peco"
autoload -Uz cool-peco
cool-peco

# zsh-autosuggestions
source /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh
```

主な変更点:
   - 起動時に一度だけ実行されればよいcompinitの呼び出しを、PreztoとPowerle
     vel10kに任せ、重複をなくしました。
   - 古いgit-prompt.shの設定を削除しました。
   - Preztoのpromptコマンドの呼び出しを削除しました。
   - Powerlevel10kの読み込みを、公式推奨の通りファイルの一番最後に移動しま
     した。

再計測

```
zsh -i -c exit  0.50s user 0.56s system 82% cpu 1.286 total
zsh -i -c exit  0.52s user 0.55s system 86% cpu 1.247 total
zsh -i -c exit  0.51s user 0.53s system 82% cpu 1.266 total
zsh -i -c exit  0.52s user 0.51s system 85% cpu 1.208 total
zsh -i -c exit  0.52s user 0.60s system 84% cpu 1.334 total
zsh -i -c exit  0.61s user 0.64s system 86% cpu 1.440 total
zsh -i -c exit  0.63s user 0.64s system 77% cpu 1.642 total
zsh -i -c exit  0.65s user 0.67s system 84% cpu 1.564 total
zsh -i -c exit  0.54s user 0.58s system 85% cpu 1.311 total
zsh -i -c exit  0.51s user 0.56s system 86% cpu 1.231 total
```

  最終的な平均起動時間は 約1.35秒 となりました。

   - 比較:
     - 初期状態の平均: 約3.6秒
     - 最終状態の平均: 約1.35秒

    約2.25秒、60%以上の大幅な高速化を達成できました！エラーメッセージも
  消え、安定して高速な状態になったと言えます。
  
まとめ

  長い道のりでしたが、体系的な調査の結果、zshの起動が遅かった根本原因を
  特定・解決できました。

   - 原因: Preztoのpromptモジュールとgitモジュールが、プロンプト表示のたび
     に重い処理を実行していたこと。また、複数のプロンプト設定が衝突してい
     たこと。
   - 解決策: それらの重いPreztoモジュール(git,
     prompt)を無効化し、代わりにHomebrewでインストールした高速なPowerlevel
     10kがプロンプト表示の全責任を担うように設定を整理しました。

  試行錯誤の連続でしたが、ご辛抱強くご協力いただき、ありがとうございまし
  た。最終的に素晴らしい結果にたどり着けて、私も大変嬉しいです。お疲れ様
  でした！
